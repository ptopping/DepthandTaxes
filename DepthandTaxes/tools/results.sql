SELECT r.stateabbreviation, r.generalvotes, r.generaldate, r.district, l.partyname party
FROM(
SELECT 
    STATENAME STATEABBREVIATION,
    PARTY PARTYABBREVIATION,
    TO_NUMBER(NUMBEROFVOTES) GENERALVOTES,
    TO_DATE('11/02/2004','MM/DD/YYYY') GENERALDATE,
    'President' DISTRICT
from presgeneral2000
WHERE NUMBEROFVOTES > 0
AND STATENAME != 'ZZZZ'
UNION
SELECT 
    STATENAME STATEABBREVIATION,
    CASE
    WHEN PARTY = 'W(R)' THEN 'R'
    WHEN PARTY = 'D/LU' THEN 'D'
    WHEN PARTY = 'W(R)/R' THEN 'R'
    WHEN PARTY = 'W(D)/R' THEN 'R'
    WHEN PARTY = 'W(D)' THEN 'D'
    WHEN PARTY = 'W(D)/R' THEN 'R'
    ELSE PARTY 
    END PARTYABBREVIATION,
    CASE
        WHEN GENERALRESULTS = 'Unopposed'
            THEN NULL
        ELSE        
            TO_NUMBER(GENERALRESULTS)        
        END AS GENERALVOTES,            
    TO_DATE('11/02/2004','MM/DD/YYYY') GENERALDATE,
    REGEXP_SUBSTR(DISTRICT, '\d*') DISTRICT
FROM house2000
WHERE GENERALRESULTS IS NOT NULL
AND STATENAME IS NOT NULL
UNION
SELECT 
    STATENAME STATEABBREVIATION,
    PARTY PARTYABBREVIATION,
    TO_NUMBER(GENERALRESULTS) GENERALVOTES,
    TO_DATE('11/02/2004','MM/DD/YYYY') GENERALDATE,
    'Senate' DISTRICT
FROM senate2000
WHERE GENERALRESULTS IS NOT NULL
AND STATENAME IS NOT NULL) r
LEFT JOIN (SELECT abbreviation, partyname FROM labels2000) l
on r.partyabbreviation = l.abbreviation;
